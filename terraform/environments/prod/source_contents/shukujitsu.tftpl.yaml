- init:
    assign:
      - bucket: ${bucket}
      - url: ${url}
- loadFile:
    try:
      steps:
        - downloadFile:
            call: http.post
            args:
              url: $${url}
              body:
                method: GET
                url: https://www8.cao.go.jp/chosei/shukujitsu/syukujitsu.csv
                is_shiftjis: true
                bucket: $${bucket}
                object: syukujitsu.csv
              auth:
                type: OIDC
    except:
      as: e
      steps:
        - access_secret:
            call: googleapis.secretmanager.v1.projects.secrets.versions.access
            args:
              name: ${slack_webhook_url_secret_id}/versions/latest
            result: base64_encoded_secret
        - notify:
            call: http.post
            args:
              url: $${text.decode(base64.decode(base64_encoded_secret.payload.data))}
              body:
                text: $${e.message}
        - raise_error:
            raise: $${e}
